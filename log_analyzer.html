<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <title>Log Analyzer</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/jquery.bootgrid.css" rel="stylesheet">
	<link href="css/bootstrap-toggle.min.css" rel="stylesheet">
    <style>
    body { padding-top: 70px; }
    table th.action {
        width: 40px;
    }
    table th.id{
        width: 10%;
    }
    table th.user{
        width: 15%;
    }

    </style>
  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <span class="navbar-brand">Log Analyzer</span>
          <span id="server_name" class="navbar-brand"></span>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="#" data-tab="help_tab">Help</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <div id="tabs">
    <div id="main_tab" class="container-fluid">
      <div class="row">
        <div><!--col-->
          <div id="techdump_panel" class="panel panel-default">
            <div class="panel-heading">
                <div class="panel-heading-text" style="display:inline-block">
                    Techdump
                </div>
            </div>
            <div class="panel-body">                
				<form class="form-inline" style="display:inline-block;">
					<div class="form-group">
						<label class="col-md-4 control-label" for="channel_number">CHANNEL</label>
						<div class="col-md-2">
						  <select id="channel_number" name="channel_number" class="form-control">
							<option value="1">Channel 1</option>
							<option value="2">Channel 2</option>
							<option value="3">Channel 3</option>
							<option value="4">Channel 4</option>
							<option value="5">Channel 5</option>
							<option value="6">Channel 6</option>
							<option value="7">Channel 7</option>
							<option value="8">Channel 8</option>
							<option value="9">Channel 9</option>
							<option value="10">Channel 10</option>
							<option value="11">Channel 11</option>
							<option value="12">Channel 12</option>
							<option value="13">Channel 13</option>
							<option value="14">Channel 14</option>
							<option value="15">Channel 15</option>
							<option value="16">Channel 16</option>
							<option value="17">Channel 17</option>
							<option value="18">Channel 18</option>
							<option value="19">Channel 19</option>
							<option value="20">Channel 20</option>
							<option value="21">Channel 21</option>
							<option value="22">Channel 22</option>
							<option value="23">Channel 23</option>
							<option value="24">Channel 24</option>
							<option value="25">Channel 25</option>
							<option value="26">Channel 26</option>
							<option value="27">Channel 27</option>
							<option value="28">Channel 28</option>
							<option value="29">Channel 29</option>
							<option value="30">Channel 30</option>
							<option value="31">Channel 31</option>
						  </select>
						</div>
					</div>
				</form>
				<label class="btn btn-default">
					<input id="upload_techdump" type="file" class="form-control" style="display:none;">
					<span>Upload</span> <span class="glyphicon glyphicon-floppy-open"></span>
				</label>				
				<button id="asset_remove_check" class="btn btn-default">
					<span>Remove</span> <span class="glyphicon glyphicon-floppy-remove"></span>
				</button>
				<button id="asset_refresh" class="btn btn-default">
					<span>Refresh</span> <span class="glyphicon glyphicon-refresh"></span>
				</button>		
					<input id="toggle_test_train" type="checkbox" checked data-toggle="toggle" data-on="TEST" data-off="TRAIN"  data-onstyle="primary" data-offstyle="info" class="checkbox">
				<!--button id="analyze" class="btn btn-default">
					<span>Analyze</span> <span class="glyphicon glyphicon-play-circle"></span>
				</button!-->
				<button id="analyze_txt_result_btn" class="btn btn-default">
					<span>Analyze TXT Result</span> <span class="glyphicon glyphicon-play-circle"></span>
				</button>
				<div id="upload_techdump_progress" class="progress"><div class="progress-bar"></div></div>
            </div>
          </div>
        </div><!--col-->
		<div><!--col-->
		<div id="training_panel" class="panel panel-default">
            <div class="panel-heading">Training</div>
            <div class="panel-body">
				<form class="form-inline" style="display:inline-block;">
					<div class="form-group">
						<label class="col-md-4 control-label" for="channel_number">LABEL</label>
						<div class="col-md-4">
						  <select id="training_label" name="training_label" class="form-control">
							<option value="1">CC</option>					
						  </select>
						</div>						
					</div>
				</form>
				<input id="toggle_good_bad" type="checkbox" checked data-toggle="toggle" data-on="GOOD" data-off="BAD" data-onstyle="success" data-offstyle="danger" class="checkbox">
				<!--button id="train" class="btn btn-default">
					<span>Train</span> <span class="glyphicon glyphicon-road"></span>
				</button!-->
				<button id="train_with_txt_btn" class="btn btn-default">
					<span>Train using TXT Result</span> <span class="glyphicon glyphicon-road"></span>
				</button>
			</div>
          </div>
        </div><!--col-->        
      </div><!--row-->
	  <div><!--row-->
		<div><!--col-->
		  <div id="analysis_panel" class="panel panel-default">
			<div class="panel-heading">Analysis</div>
			<div class="panel-body">				
			</div>
		  </div>
		</div><!--col-->
	  </div>
    </div><!--main_tab-->

    <div id="second_tab" class="container-fluid">
      <div class="row">
        

        <div><!--col-->
          <div id="capturing_panel" class="panel panel-default">
            <div class="panel-heading">dummy</div>
            <div class="panel-body">                
            </div>
          </div>
        </div><!--col-->

      </div><!--row-->
    </div><!--second_tab-->

    <div id="help_tab" class="container-fluid">
          <div id="settings_panel" class="panel panel-default">
            <div class="panel-heading">About</div>
            <div class="panel-body">
              <h1>TranscodePack Log Analyzer</h1>

              <div id="api_help">
                <h3>API Help</h3>
              </div>
              <h3>Credit</h3>
              <pre>
Log Analyzer is built on these tools:
Backend
- Python
Frontend
- Twitter Bootstrap http://getbootstrap.com/
- jQuery https://jquery.com/
- Bootgrid http://www.jquery-bootgrid.com/
- Bootstrap Notify http://bootstrap-growl.remabledesigns.com/
- Bootstrap Toggle http://www.bootstraptoggle.com/
              </pre>
            </div>
          </div>
    </div><!--help_tab-->

    </div><!--tabs-->

    <div id="train_with_txt_dialog" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            <h4 class="modal-title">Train with TXT</h4>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label>Start TXT Result Directory Path</label>
                <input type="text" class="form-control" name="start_txt_path">
              </div>              
			  <div class="form-group">
                <label>End TXT Result Directory Path</label>
                <input type="text" class="form-control" name="end_txt_path">
              </div>
			  <div class="form-group">
                <label>Channel Number</label>
                <input type="text" class="form-control" name="channel_number_dialog">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary action">Train with TXT</button>
          </div>
        </div>
      </div>
    </div><!--train_with_txt_dialog-->	
	
    <div id="analyze_txt_result_dialog" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
            <h4 class="modal-title">Analyze TXT Result</h4>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label>Start TXT Result Directory Path</label>
                <input type="text" class="form-control" name="start_txt_path">
              </div>              
			  <div class="form-group">
                <label>End TXT Result Directory Path</label>
                <input type="text" class="form-control" name="end_txt_path">
              </div>
			  <div class="form-group">
                <label>Channel Number</label>
                <input type="text" class="form-control" name="channel_number_dialog">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary action">Analyze TXT Result</button>
          </div>
        </div>
      </div>
    </div><!--analyze_txt_result_dialog-->		

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap-notify.js"></script>
    <script src="js/jquery.bootgrid.js"></script>
    <script src="js/UI.js"></script>
	<script src="js/bootstrap-toggle.min.js"></script>
    <script>
    var capturing = {};

    UI.setup({
        tabs:
        {
            'main_tab':
            {
                panels:
                {
                    'techdump_panel':
                    {
                        width: 6,
                        widable: true
                    },                    
					'training_panel':
                    {
                        width: 6,
                        widable: true
                    },
					'analysis_panel':
					{
                        width: 14,
                        widable: true
                    }					
                },
                actions:
                [   
                    /*
					{
                        oper: 'status',
                        param: {type: 'sync'},
                        action: make_sync_status,
                        periodic: 3
                    },
                    {
                        oper: 'assets',
                        action: make_assets_table,
                        periodic: 60*10 //10 min
                    },
                    {
                        oper: 'status',
                        param: {type:'stream'},
                        action: make_streaming_table,
                        periodic: 3
                    }
					*/
                ]
            },
            'second_tab':
            {
                panels:
                {                    
                    'capturing_panel': {}
                },
                actions:
                [
                    /*
					{
                        oper: 'scan',
                        action: make_streams_table,
                        periodic: 6
                    },
                    {
                        oper: 'status',
                        param: {type:'capture'},
                        action: make_capturing_table,
                        periodic: 2
                    }*/
                ]
            },
            'help_tab':
            {
            }
        },
        
		dialogs:
        {
            'train_with_txt_dialog':
            {
                action: function (start_txt_path, end_txt_path, channel_number)
                {
						operation('train_with_txt', {
                            start_txt_path: start_txt_path,
                            end_txt_path: end_txt_path,
							channel_number: channel_number
                        }, notify);
                    return true;
                }
            },
			'analyze_txt_result_dialog':
            {
                action: function (start_txt_path, end_txt_path, channel_number)
                {
						operation('analyze_txt_result', {
                            start_txt_path: start_txt_path,
                            end_txt_path: end_txt_path,
							channel_number: channel_number
                        }, notify);
                    return true;
                }
            }             
        }
    });
    setup_functions();	

    function setup_functions()
    {		
		var filename = ""
		var channel = "1"
		var training_label_value = "CC"
		
		$('#channel_number').on('change', function()
		{
			channel = $(this).val()
		});
		
		$('#training_label').on('change', function()
		{
			training_label_value = $(this).val()
		});		
		
		$('#train_with_txt_btn').click(function()
        {
            notify({
                    message: 'train with txt'
                });
			$('#train_with_txt_dialog').modal();
        });
		
		$('#analyze_txt_result_btn').click(function()
        {
            notify({
                     message: 'analyze with txt'
                });
			$('#analyze_txt_result_dialog').modal();
        });
		
		$('#upload_techdump').on('change', function(event)
        {
            var file = event.target.files[0];
            var req = new XMLHttpRequest();
			filename = file.name
            req.open('PUT', '/techdumps/'+file.name);
            req.onload = function(event) {
                notify({
                    message: 'upload '+file.name+' completed'
                });
                $('#upload_techdump_progress').hide();
                $('#upload_techdump_progress .progress-bar').width(0+'%');
                //operation('assets', '', make_assets_table);
            }
            req.onerror = function(event) {
                notify({
                    exception: 'upload failed'
                });
                $('#upload_techdump_progress').hide();
            }
            req.upload.onprogress = function(event) {
                var per = event.loaded/event.total*100;
                $('#upload_techdump_progress .progress-bar').width(per+'%');
            }
            $('#upload_techdump_progress').show();
            req.send(file);
            notify({
                message: 'uploading...'
            });
        });
        $('#upload_techdump_progress').hide();

        $('#asset_remove_check').click(function(){
            files = [];
            $("input[name=rm]:checked").each(function(){
                files.push($(this).val());
            });
            console.log(files);
            $('#remove_dialog').modal('show')
                .find('p[name="asset"]').text(files);
        });

        $('#asset_remove').click(function(){
            files = [];
            $("input[name=rm]:checked").each(function(){
                files.push($(this).val());
            });
            operation('remove', files, function(res){
                notify(res);
                operation('assets', '', make_assets_table);
            });
        });

        $('#asset_sync_dialog_fetch').click(function(){
            var $inputs = $('#sync_dialog input');
            var params = {};
            $inputs.each(function(){
                params[this.name] = $(this).val();
            });
            operation('sync', params, function(res){
                notify(res);
                operation('assets', '', make_assets_table);
            });
        });

        $('#asset_sync_dialog_push').click(function(){
            var $inputs = $('#sync_dialog input');
            var params = {};
            $inputs.each(function(){
                params[this.name] = $(this).val();
            });
            operation('ask_to_sync', params, function(res){
                notify(res);
            });
        });

        $('#asset_refresh').click(function()
        {
            operation('refresh', '', function(res)
            {
                notify(res);
                operation('assets', '', make_assets_table);
            });
        });

        $('#asset_sync').click(function(){
            $('#sync_dialog').modal('show');
        });
		
		$('#analyze').click(function()
        {
            var params = {};			
			params['channel_number'] = channel
			params['filename'] = filename
			operation('analyze', params, function(res)
            {
                notify(res);                
            });
        });
		
		$('#train').click(function()
        {
            var params = {};			
			params['channel_number'] = channel
			params['filename'] = filename
			params['training_label'] = training_label_value
			operation('train', params, function(res)
            {
                notify(res);                
            });
        });
		
		$(document).ready(function () {	
			$('#training_panel').hide();
			$('#toggle_test_train').change(function() 
			{		  
			  if ($(this).prop('checked')) {
				//console.log("hide")	
				$('#analyze').show();
				$('#training_panel').hide();
			  }
			  else {
				//console.log("show")				
				$('#analyze').hide();
				$('#training_panel').show();
			  }		  
			});	
		});
    }
    function make_sync_status(data)
    {
        var title = 'Assets';
        if ('log' in data && data['log'].indexOf('Ready') == -1) {
            var title = 'Assets (' + data['log'] + ')';
            $('#assets_panel .panel-heading .panel-heading-text').text(title);
            operation('refresh', '', function(res)
            {
                operation('assets', '', make_assets_table);
            });
        } else {
            $('#assets_panel .panel-heading .panel-heading-text').text(title);
        }
    }    
    </script>
  </body>
</html>
